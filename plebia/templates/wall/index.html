<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en-US" xml:lang="en-US" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Plebia - Social sharing for media content</title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

    <!-- CSS -->
    <link type="text/css" rel="stylesheet" href="/static/css/all.css"> 
    <link type="text/css" rel="stylesheet" href="http://freebaselibs.com/static/suggest/1.3/suggest.min.css" />
    <link type="text/css" rel="stylesheet" href="/static/css/dist/video-js.css"> 
    <link type="text/css" rel="stylesheet" href="/static/css/dist/video-js-vim.css"> 
    <link type="text/css" href="/static/css/dist/jquery-ui-le-frog/jquery-ui-1.8.14.custom.css" rel="stylesheet" />

    <!-- JS -->
    <script type="text/javascript" src="/static/js/dist/jquery-1.6.2.min.js"></script>
    <script type="text/javascript" src="/static/js/dist/jquery-ui-1.8.14.custom.min.js"></script>
    <script type="text/javascript" src="http://freebaselibs.com/static/suggest/1.3/suggest.min.js"></script>
    <script type="text/javascript" src="/static/js/dist/video.js" charset="utf-8"></script> 
    <script type="text/javascript">
        $(function() {
            // Dress buttons
            $('input:submit').button();

            // Dress progress bars
            $(".torrent_progress").each(function() {
                $(this).progressbar({
    		    	value: Math.round($(this).attr('data'))
                });
    		});

            // Load auto-suggest
            $("#id_series_name").suggest({type:'/tv/tv_program'});

            // Load all videos on the page
            var myManyPlayers = VideoJS.setup("All", {
                controlsBelow: false, // Display control bar below video instead of in front of
                controlsHiding: true, // Hide controls when mouse is not over the video
                defaultVolume: 0.85, // Will be overridden by user's last volume if available
                flashVersion: 9, // Required flash version for fallback
                linksHiding: true // Hide download links when video is supported
            });
        });
    </script>
</head>

<body> 
    <div class="stream">
        <div class="stream_new_post">
            <form action="/" method="post">
                {% csrf_token %}
                {{ form.as_p }}
                <input type="submit" value="Add" />
                <div class="clear_both"></div>
            </form>
        </div>

        <h2>Stream</h2>
        {% if latest_post_list %}
        {% for post in latest_post_list %}
        <div class="stream_post">
            <img src="/static/img/avatar.jpg" class="user_avatar" />
            <div class="user_name">Xavier Antoviaque</div>
            <div class="post_time">- {{ post.pub_date }}</div>
            <div class="post_title"><a href="/downloads/{{ post.torrent_name }}">{{ post.series_name }} - Season {{ post.series_season }}, episode {{ post.series_episode }}</a></div>
        {% if post.torrent_status == 'Completed' %}
            <div class="video-js-box vim-css"> 
                <video class="video-js" width="640" height="360" controls="controls" preload="auto" poster="/downloads/{{ post.file_path }}.jpg"> 
                <!--<source src="/downloads/{{ post.file_path }}.mp4" type='video/mp4; codecs="avc1.42E01E, mp4a.40.2"' /> -->
                    <source src="/static/stream.php?file_path={{ post.file_path }}" type='video/webm; codecs="vp8, vorbis"' />
                    <object class="vjs-flash-fallback" width="640" height="264" type="application/x-shockwave-flash" data="http://releases.flowplayer.org/swf/flowplayer-3.2.1.swf"> 
                        <param name="movie" value="http://releases.flowplayer.org/swf/flowplayer-3.2.1.swf" /> 
                        <param name="allowfullscreen" value="true" /> 
                        <param name="flashvars" value='config={"playlist":["/downloads/{{ post.file_path }}.jpg", {"url": "/downloads/{{ post.file_path }}.mp4","autoPlay":false,"autoBuffering":true}]}' /> 
                        <img src="/downloads/{{ post.file_path }}.jpg" width="640" height="264" alt="Poster Image" title="No video playback capabilities." /> 
                    </object> 
                </video> 
                <p class="vjs-no-video"><strong>Download Video:</strong> 
                <!--<a href="/downloads/{{ post.file_path }}.mp4">MP4</a>,-->
                    <a href="/downloads/{{ post.file_path }}.webm">WebM</a>
                </p> 
            </div> 
        {% else %}
        <div class="torrent_progress_info">Preparing the video... {{ post.torrent_progress }}% done.</div>
        <div class="torrent_progress" data="{{ post.torrent_progress }}"></div>
        {% endif %}
        </div>
        {% endfor %}
    {% else %}
        <p>No posts yet.</p>
    {% endif %}

    <div class="footer">
        Media server powered by
        <a href="http://plebia.org/">plebia</a>
        (with the help of
        <a href="http://videojs.com">video.js</a>,
        <a href="http://deluge-torrent.org/">deluge</a>,
        <a href="http://www.ffmpeg.org/">ffmpeg</a> and
        <a href="https://www.djangoproject.com/">django</a>)
    </div>
</body>
</html>
