<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en-US" xml:lang="en-US" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Plebia - Social sharing for media content</title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

    <!-- CSS -->
    <link type="text/css" rel="stylesheet" href="/static/css/all.css"> 
    <link type="text/css" rel="stylesheet" href="http://freebaselibs.com/static/suggest/1.3/suggest.min.css" />
    <link type="text/css" rel="stylesheet" href="/static/css/dist/video-js.css"> 
    <link type="text/css" rel="stylesheet" href="/static/css/dist/video-js-vim.css"> 
    <link type="text/css" href="/static/css/dist/jquery-ui-le-frog/jquery-ui-1.8.14.custom.css" rel="stylesheet" />

    <!-- JS -->
    <script type="text/javascript" src="/static/js/dist/jquery-1.6.2.min.js"></script>
    <script type="text/javascript" src="/static/js/dist/jquery-ui-1.8.14.custom.min.js"></script>
    <script type="text/javascript" src="http://freebaselibs.com/static/suggest/1.3/suggest.min.js"></script>
    <script type="text/javascript" src="/static/js/dist/video.js" charset="utf-8"></script> 
    <script type="text/javascript" src="/static/js/plebia.js" charset="utf-8"></script> 
    </script>
</head>

<body> 
    <div class="stream">
        <div class="stream_new_post">
            <form action="/" method="post">
                {% csrf_token %}
                {{ form.as_p }}
                <input type="submit" value="Add" />
                <div class="clear_both"></div>
            </form>
        </div>

        <p>To add/upload a video to the stream, fill the form right on top. <br /><b>Warning</b>: videos can only be watched with Chromium/Chrome for now.</p>

        <h2>Stream</h2>
        {% if latest_post_list %}
        {% for post in latest_post_list %}
        <div class="stream_post{% if post.torrent_status != 'Completed' %} stream_post_in_progress{% endif %}" id="post_{{ post.id }}">
            <img src="/static/img/avatar.jpg" class="user_avatar" />
            <div class="user_name">Xavier Antoviaque</div>
            <div class="post_time">- {{ post.pub_date }}</div>
            <div class="post_title">
                <a href="/downloads/{{ post.torrent_name }}">
                    {{ post.series_name }} - Season {{ post.series_season }}, episode {{ post.series_episode }}
                    <img src="/static/img/download.png" class="download_icon" />
                </a></div>
            <div class="post_content">
                {% if post.torrent_status == 'Completed' %}
                    {% include "wall/video.html" %}            
                {% else %}
                    <div class="torrent_progress_info">
                        <img src="/static/img/loading.gif" class="loading_icon" />
                        &nbsp;<span class="torrent_status">Locating the video... (takes 30-90 seconds)</span>
                        <span class="torrent_progress">
                            <span class="torrent_progress_percent">{{ post.torrent_progress }}</span>% done.
                        </span>
                    </div>
                    <div class="torrent_progress_bar" data="{{ post.torrent_progress }}"></div>
                {% endif %}
            </div> 
            <div class="next_episode">
                <form action="/" method="post">
                    {% csrf_token %}
                    <input id="id_series_name" type="hidden" name="series_name" value="{{ post.series_name }}" />
                    <input type="hidden" name="series_season" id="id_series_season" value="{{ post.series_season }}" />
                    <input type="hidden" name="series_episode" id="id_series_episode" value="{{ post.series_episode|add:1 }}" />
                    <a href="javascript://">Next episode >></a>
                    <div class="clear_both"></div>
                </form>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <p>No posts yet.</p>
    {% endif %}

    <div class="footer">
        Media server powered by
        <a href="http://plebia.org/">plebia</a>
        (with the help of
        <a href="http://videojs.com">video.js</a>,
        <a href="http://deluge-torrent.org/">deluge</a>,
        <a href="http://www.ffmpeg.org/">ffmpeg</a> and
        <a href="https://www.djangoproject.com/">django</a>)
    </div>
</body>
</html>
