<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en-US" xml:lang="en-US" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Plebia - Social sharing for media content</title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

    <!-- CSS -->
    <link type="text/css" rel="stylesheet" href="/static/css/all.css"> 
    <link type="text/css" rel="stylesheet" href="http://freebaselibs.com/static/suggest/1.3/suggest.min.css" />
    <link type="text/css" rel="stylesheet" href="/static/css/dist/video-js.css"> 
    <link type="text/css" rel="stylesheet" href="/static/css/dist/video-js-vim.css"> 
    <link type="text/css" href="/static/css/dist/jquery-ui-le-frog/jquery-ui-1.8.14.custom.css" rel="stylesheet" />

    <!-- JS -->
    <script type="text/javascript" src="/static/js/dist/jquery-1.6.2.min.js"></script>
    <script type="text/javascript" src="/static/js/dist/jquery-ui-1.8.14.custom.min.js"></script>
    <script type="text/javascript" src="http://freebaselibs.com/static/suggest/1.3/suggest.min.js"></script>
    <script type="text/javascript" src="/static/js/dist/video.js" charset="utf-8"></script> 
    <script type="text/javascript" src="/static/js/plebia.js" charset="utf-8"></script> 
    </script>
</head>

<body> 
    <div class="stream">
        <div class="plebia_updates">
            <b>Last updates (Sun Jul 31st):</b><br />
            <ul>
                <li>Now videos can be paused, resumed and moved forward/backward at any point, once they have been fully transcoded</li>
                <li>Fixed mulitple issues with progress bars when several videos are loading at the same time</li>
            </ul>
        </div>
        <div class="stream_new_post">
            <form action="/" method="post">
                {% csrf_token %}
                {{ form.as_p }}
                <input type="submit" value="Add" />
                <div class="clear_both"></div>
            </form>
        </div>

        <p>To add/upload a video to the stream, fill the form right on top. <br /><b>Warning</b>: videos can only be watched with Chromium/Chrome for now.</p>

        <h2>Stream</h2>
        {% if latest_post_list %}
        {% for post in latest_post_list %}

            {% with post.episode as episode %}
            {% with episode.season as season %}
            {% with episode.torrent as torrent %}
            {% with episode.video as video %}
            {% with season.series as series %}

            <div class="stream_post{% if torrent.status == 'New' or torrent.status == 'Downloading' %} stream_post_torrent_update{% endif %}{% if video.status == 'New' or video.status == 'Transcoding' %} stream_post_video_update{% endif %}" id="post_{{ post.id }}">

                <input type="hidden" name="episode_api_url" class="episode_api_url" value="{% if episode %}/api/v1/seriesseasonepisode/{{ episode.id }}/{% endif %}" />
                <input type="hidden" name="torrent_api_url" class="torrent_api_url" value="{% if torrent %}/api/v1/torrent/{{ torrent.id }}/{% endif %}" />
                <input type="hidden" name="video_api_url" class="video_api_url" value="{% if video %}/api/v1/video/{{ video.id }}/{% endif %}" />
                <img src="/static/img/avatar.jpg" class="user_avatar" />
                <div class="user_name">Xavier Antoviaque</div>
                <div class="post_time">- {{ post.date_added }}</div>
                <div class="post_title">
                    <a href="/downloads/{{ video.original_path }}">
                        {{ series.name }} - Season {{ season.number }}, Episode {{ episode.number }}
                        <img src="/static/img/download.png" class="download_icon" />
                    </a></div>
                <div class="post_content">
                    {% if not torrent %}
                        <div class="torrent_not_found">
                            <img src="/static/img/monster.jpg" class="monster_icon" />
                            <div class="torrent_not_found_msg">I'm sorry, I couldn't find your video : (<br />But try to enter another one, I'll go get it! :D</div>
                        </div>
                    {% else %} {% if video.status == 'Transcoding' or video.status == 'Completed' %}
                        {% include "wall/video.html" %}            
                    {% else %}
                        <div class="torrent_progress_info">
                            <span class="torrent_status">Video found! Initializing download... (takes 30-90 seconds)</span>
                            <span class="torrent_progress">
                                (<span class="torrent_progress_percent">{{ torrent.progress }}</span>% done)
                            </span>
                            &nbsp;<img src="/static/img/loading.gif" class="loading_icon" />
                        </div>
                        <div class="torrent_progress_bar" data="{{ torrent.progress }}"></div>
                    {% endif %} {% endif %}
                </div> 
                <div class="next_episode">
                    <form action="/" method="post">
                        {% csrf_token %}
                        <input id="id_name2" type="hidden" name="name" value="{{ series.name }}" />
                        <input type="hidden" name="season" id="id_season2" value="{{ season.number }}" />
                        <input type="hidden" name="episode" id="id_episode2" value="{{ episode.number|add:1 }}" />
                        <a href="javascript://">Next episode >></a>
                        <div class="clear_both"></div>
                    </form>
                </div>
            </div>

            {% endwith %}
            {% endwith %}
            {% endwith %}
            {% endwith %}
            {% endwith %}
        {% endfor %}
    {% else %}
        <p>No posts yet.</p>
    {% endif %}

    <div class="footer">
        Media server powered by
        <a href="http://plebia.org/">plebia</a>
        (with the help of
        <a href="http://videojs.com">video.js</a>,
        <a href="http://deluge-torrent.org/">deluge</a>,
        <a href="http://www.ffmpeg.org/">ffmpeg</a> and
        <a href="https://www.djangoproject.com/">django</a>)
    </div>
</body>
</html>
