= 1. Server =

= 1a. Requirements =

    * Recent processor (i5), to be able to transcode faster than the movie display
    * Bandwidth 20Mbps+ up/down 

= 1b. Dependencies =

Install packages (Debian/Ubuntu):

    $ sudo apt-get install python-pip
    $ sudo pip install Django==1.2.5
    $ sudo easy_install South
    $ sudo apt-get install python-mechanize

Install development version of ffmpeg, with libvpx: http://ubuntuforums.org/showthread.php?t=786095 (works for Ubuntu and Debian - for Debian repositories to add: http://debian-multimedia.org/ )

Install deluge-console and deluged 1.3.3 

    $ wget http://download.deluge-torrent.org/source/deluge-1.3.3.tar.gz

Follow instructions at http://dev.deluge-torrent.org/wiki/Installing/Source

Then in configurations file (with deluged process not running):

    <   "max_active_downloading": 3, 
    ---
    >   "max_active_downloading": 10, 


= 2. Configuration =

Change paths:
    - in plebia/settings.py
        * DOWNLOAD_DIR
        * DELUGE_COMMAND (login/pass in ~/.config/deluge/auth)
        * FFMPEG_PATH
        * FFMPEG2THEORA_PATH
    - in static/stream.php
        * full_file_path
    - in webserver/apache/django.wsgi
        * path

Create database:

    $ plebia/manage.py syncdb
    $ plebia/manage.py migrate

Add cron:

    * * * * * /var/www/plebia/plebia/manage.py cron &>> /var/www/plebia/log/cron.log

= 2a. Development environment =

Configure apache to serve:

    ProxyPass /downloads/ !
    Alias /downloads/ "/home/antoviaque/Downloads/"
    <Directory "/home/antoviaque/Downloads">
        Options -Indexes
        AllowOverride None
    </Directory>

    ProxyPass /static/ !
    Alias /static/ "/home/antoviaque/prog/plebia/static/"
    <Directory "/home/antoviaque/prog/plebia/static/">
        Options -Indexes
        AllowOverride All
    </Directory>

    ProxyPass / http://localhost:7070/
    ProxyPassReverse / http://localhost:7070/

= 2b. Production server =

For apache, use mod-wsgi:

    $ sudo apt-get install libapache2-mod-wsgi

Add to apache config, in virtual host:

    <Location />
        AuthUserFile /var/www/.htpasswd
        AuthGroupFile /dev/null
        AuthName "Media server - coming back soon (tm)"
        AuthType Basic

        <Limit GET>
            require valid-user
        </Limit>
    </Location>

    Alias /downloads/ "/var/www/downloads/"
    <Directory "/var/www/downloads">
        Options -Indexes
        AllowOverride None
    </Directory>

    Alias /static/ "/var/www/plebia/static/"
    <Directory "/var/www/plebia/static/">
        Options -Indexes
        AllowOverride All
    </Directory>

    WSGIScriptAlias / /var/www/plebia/webserver/apache/django.wsgi

Add login/password:

    $ htpasswd -c /var/www/.htpasswd media


= 3. Running =

    $ deluged

If running the developer environment:

    $ plebia/manage.py runserver 0.0.0.0:7070


= A. Annex - Configuration from bare Debian 6.0 squeeze =

Edit hostname:

    # echo "my.host.org" > /etc/hostname ; hostname -F /etc/hostname

Check /root permissions:

    # chown root.root /root ; chmod 750 /root ; chmod 700 ~/.ssh

Add public key and edit password:

    # rm -f /root/ssh/authorized_keys* ; cat > /root/.ssh/authorized_keys
    # passwd

Install sudo & debian-multimedia keyring:

    # apt-get install sudo
    # mkdir dl ; cd dl ; wget http://www.debian-multimedia.org/pool/main/d/debian-multimedia-keyring/debian-multimedia-keyring_2010.12.26_all.deb ; dpkg -i debian-multimedia-keyring_2010.12.26_all.deb

Edit /etc/apt/sources.list :

deb http://mirror.ovh.net/debian/ squeeze main contrib non-free
deb-src http://mirror.ovh.net/debian/ squeeze main contrib non-free

deb http://security.debian.org/ squeeze/updates main contrib non-free
deb-src http://security.debian.org/ squeeze/updates main contrib non-free

deb http://www.debian-multimedia.org squeeze main non-free

    # apt-get update
    # apt-get dist-upgrade

Install apache

    # apt-get install libapache2-mod-php5 libapache2-mod-wsgi

